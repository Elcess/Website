<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.42.1" />


<title>Visualizing US Birth Rate from 1998 to 2015 - Kimberley&#39;s website</title>
<meta property="og:title" content="Visualizing US Birth Rate from 1998 to 2015 - Kimberley&#39;s website">



  








<link href='//cdn.bootcss.com/highlight.js/9.11.0/styles/github.min.css' rel='stylesheet' type='text/css' />



<link rel="stylesheet" href="/css/fonts.css" media="all">
<link rel="stylesheet" href="/css/main.css" media="all">



  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="/" class="nav-logo">
    <img src="/images/HomeImage.jpg"
         width="50"
         height="50"
         alt="Logo">
  </a>

  <ul class="nav-links">
    
    <li><a href="/about/">About</a></li>
    
    <li><a href="https://github.com/Elcess">GitHub</a></li>
    
    <li><a href="https://www.linkedin.com/in/kimberleyelcess/">LinkedIn</a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">

  <article class="article">
    
    <span class="article-duration">9 min read</span>
    

    <h1 class="article-title">Visualizing US Birth Rate from 1998 to 2015</h1>

    
    <span class="article-date">2017/05/05</span>
    

    <div class="article-content">
      <p>To explore the relationship between economic factors and birth rate, chart US birth rate over a time period with changing economic conditions.</p>
<div id="project-overview" class="section level1">
<h1>Project Overview</h1>
<div id="data" class="section level2">
<h2>Data</h2>
<p>Previously gathered and tidied data on US births by State and year were read into a programming environment.</p>
</div>
<div id="technologies" class="section level2">
<h2>Technologies</h2>
<p>The R programming language was used to read, transform, and plot data. Packages used included plyr, dplyr, data.table, and ggplot2, all from the <code>tidyverse</code>.</p>
</div>
<div id="techniques" class="section level2">
<h2>Techniques</h2>
<p>Data files in several formats were read into a programming environment. Data frames generated by reading in data were transformed by selecting, filtering, and combining to obtain datasets relevant to the visualization. New features were generated for some datasets by calculation from existing features in multiple tables. Data were plotted as time series and as comparison scatter plots using the ggplot2 package for R.</p>
</div>
<div id="software" class="section level2">
<h2>Software</h2>
<p>RStudio running R on a Windows OS desktop computer was used as the development environment.</p>
</div>
<div id="lessons-learned" class="section level2">
<h2>Lessons Learned</h2>
<p>Cleaned data must usually be further transformed to be useful in a visualization. When using the ggplot2 package for R, in particular, it is often easier to generate a dataset with all the features to be used in charts rather than attempt to use series from different datasets.</p>
</div>
<div id="applications" class="section level2">
<h2>Applications</h2>
<p>Visualization is an important part of exploratory data analysis and communicating results. Data preparation is often required to yield useful charts and graphs.</p>
</div>
</div>
<div id="Background" class="section level1">
<h1>Project Background</h1>
<p>A Pew Research Center report published April 6, 2010<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> linked a decline in the US birth rate to the recession of 2008. They used birth data from 25 US States for which 2008 full-year records were available. This project was intended to investigate whether the trend was generalized to all 50 States and to see if the birth rate increased after the initial drop.</p>
</div>
<div id="Step1" class="section level1">
<h1>Step 1 – Extracting the Data</h1>
<p>Population projections by State for the period 1998–2002 were stored in fixed-width format text files. This was read into R data frames and stored for later use.</p>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## -- Attaching packages --------------------------------------------------------------------------------- tidyverse 1.2.1 --</code></pre>
<pre><code>## v ggplot2 2.2.1     v purrr   0.2.5
## v tibble  1.4.2     v dplyr   0.7.5
## v tidyr   0.8.1     v stringr 1.3.1
## v readr   1.1.1     v forcats 0.3.0</code></pre>
<pre><code>## -- Conflicts ------------------------------------------------------------------------------------ tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>iwidths &lt;- c(2, 1, 4, 2, rep(8, 16))
cols &lt;- c(&quot;State&quot;, &quot;Series&quot;, &quot;Year&quot;, &quot;Age&quot;, &quot;WNHM&quot;, &quot;WNHF&quot;, &quot;WHM&quot;, &quot;WHF&quot;,
          &quot;BNHM&quot;, &quot;BNHF&quot;, &quot;BHM&quot;, &quot;BHF&quot;, &quot;AINHM&quot;, &quot;AINHF&quot;, &quot;AIHM&quot;, &quot;AIHF&quot;,
          &quot;APNHM&quot;, &quot;APNHF&quot;, &quot;APHM&quot;, &quot;APHF&quot;)
st50 &lt;- state.abb

## Test with one state first
ak0105 &lt;- read.fwf(file = &quot;AK0105.DAT&quot;, widths = iwidths, col.names = cols)

ak2002A &lt;- filter(ak0105, Year == 2002 &amp; Series == &quot;A&quot;)
ak2002Atotal &lt;- sum(rowSums(ak2002A[,5:20]))
ak2002B &lt;- filter(ak0105, Year == 2002 &amp; Series == &quot;B&quot;)
ak2002Btotal &lt;- sum(rowSums(ak2002B[,5:20]))
ak2001A &lt;- filter(ak0105, Year == 2001 &amp; Series == &quot;A&quot;)
ak2001Atotal &lt;- sum(rowSums(ak2001A[,5:20]))
ak2001B &lt;- filter(ak0105, Year == 2001 &amp; Series == &quot;B&quot;)
ak2001Btotal &lt;- sum(rowSums(ak2001B[,5:20]))


stpops &lt;- tibble(Year = 2001, StateCode = &quot;AK&quot;, Series = &quot;A&quot;,
                 Pop = ak2001Atotal)

stpops &lt;- rbind(stpops, tibble(Year=2001, StateCode=&quot;AK&quot;, Series=&quot;B&quot;,
                               Pop=ak2001Btotal))
stpops &lt;- rbind(stpops, tibble(Year=2002, StateCode=&quot;AK&quot;, Series=&quot;A&quot;,
                               Pop=ak2002Atotal))
stpops &lt;- rbind(stpops, tibble(Year=2002, StateCode=&quot;AK&quot;, Series=&quot;B&quot;,
                               Pop=ak2002Btotal))

## Do the rest
for(st in st50) {
    if(st != &quot;AK&quot;) {
        fname &lt;- paste0(st, &quot;0105.DAT&quot;)
        st0105 &lt;- read.fwf(file = fname, widths = iwidths,
                           col.names = cols)
        st2002A &lt;- filter(st0105, Year == 2002 &amp; Series == &quot;A&quot;)
        st2002Atotal &lt;- sum(rowSums(st2002A[,5:20]))
        st2002B &lt;- filter(st0105, Year == 2002 &amp; Series == &quot;B&quot;)
        st2002Btotal &lt;- sum(rowSums(st2002B[,5:20]))
        st2001A &lt;- filter(st0105, Year == 2001 &amp; Series == &quot;A&quot;)
        st2001Atotal &lt;- sum(rowSums(st2001A[,5:20]))
        st2001B &lt;- filter(st0105, Year == 2001 &amp; Series == &quot;B&quot;)
        st2001Btotal &lt;- sum(rowSums(st2001B[,5:20]))
        stpops &lt;- rbind(stpops, tibble(Year=2001, StateCode=st, Series=&quot;A&quot;,
                                       Pop=st2001Atotal),
                        tibble(Year=2001, StateCode=st, Series=&quot;B&quot;,
                               Pop=st2001Btotal),
                        tibble(Year=2002, StateCode=st, Series=&quot;A&quot;,
                               Pop=st2002Atotal),
                        tibble(Year=2002, StateCode=st, Series=&quot;B&quot;,
                               Pop=st2002Btotal))
    }
}

for(st in st50) {
    fname &lt;- paste0(tolower(st), &quot;9500.txt&quot;)
    st9500 &lt;- read.fwf(file = fname, widths = iwidths,
                       col.names = cols)
    st1998A &lt;- filter(st9500, Year == 1998 &amp; Series == &quot;A&quot;)
    st1998Atotal &lt;- sum(rowSums(st1998A[,5:20]))
    st1998B &lt;- filter(st9500, Year == 1998 &amp; Series == &quot;B&quot;)
    st1998Btotal &lt;- sum(rowSums(st1998B[,5:20]))
    st1999A &lt;- filter(st9500, Year == 1999 &amp; Series == &quot;A&quot;)
    st1999Atotal &lt;- sum(rowSums(st1999A[,5:20]))
    st1999B &lt;- filter(st9500, Year == 1999 &amp; Series == &quot;B&quot;)
    st1999Btotal &lt;- sum(rowSums(st1999B[,5:20]))
    st2000A &lt;- filter(st9500, Year == 2000 &amp; Series == &quot;A&quot;)
    st2000Atotal &lt;- sum(rowSums(st2000A[,5:20]))
    st2000B &lt;- filter(st9500, Year == 2000 &amp; Series == &quot;B&quot;)
    st2000Btotal &lt;- sum(rowSums(st2000B[,5:20]))
    stpops &lt;- rbind(stpops, tibble(Year=1998, StateCode=st, Series=&quot;A&quot;,
                                   Pop=st1998Atotal),
                    tibble(Year=1998, StateCode=st, Series=&quot;B&quot;,
                           Pop=st1998Btotal),
                    tibble(Year=1999, StateCode=st, Series=&quot;A&quot;,
                           Pop=st1999Atotal),
                    tibble(Year=1999, StateCode=st, Series=&quot;B&quot;,
                           Pop=st1999Btotal),
                    tibble(Year=2000, StateCode=st, Series=&quot;A&quot;,
                           Pop=st2000Atotal),
                    tibble(Year=2000, StateCode=st, Series=&quot;B&quot;,
                           Pop=st2000Btotal))
}</code></pre>
<p>Births by State for the period 1998–2002 were stored in tab-delimited text files. Births, total population, and crude birth rate (births per 1,000 people) by State for the period 2003–2015 were stored in tab-delimited text files. This data was read into R data frames and stored for later use.</p>
<pre class="r"><code>births9502 &lt;- read.delim(file = &quot;1995-2002Births.txt&quot;)
births9502 &lt;- births9502[1:408,]
births0306 &lt;- read.delim(file = &quot;2003-2006Births.txt&quot;, nrows = 204)
births0715 &lt;- read.delim(file = &quot;2007-2015Births.txt&quot;, nrows = 459)

## Select relevant columns and years from birth data
births9502 &lt;- select(births9502, Year, State, Births) %&gt;%
        filter(Year != 1995 &amp; Year != 1996 &amp; Year != 1997)
births0306 &lt;- select(births0306, Year, State, Births, TotalPopulation, BirthRate)
births0715 &lt;- select(births0715, Year, State, Births, TotalPopulation, BirthRate)</code></pre>
</div>
<div id="Step2" class="section level1">
<h1>Step 2 – Transforming the Data</h1>
<p>Two population projections were provided by race, Hispanic origin, and gender by single year of age for each state for each year from 1995–2005. Projection data was summed by individual projection to obtain total population by State for the years 1998–2002, and data from all States was combined into a single data frame. Data prepared this way for Alaska in 2003 was compared with the total Alaska population for 2003 in the CDC natality file for 2003–2006, and the Series B projection was a closer fit. The Series B population projections were then used for all States from 1998–2002 for subsequent analysis.</p>
<pre class="r"><code>## Prepare to join based on state name in natality data
st50 &lt;- tibble(StateCode = state.abb, State = state.name)
stpops &lt;- inner_join(stpops, st50)</code></pre>
<pre><code>## Joining, by = &quot;StateCode&quot;</code></pre>
<pre class="r"><code>## Use Series B projections because they are closer for AK 2003
stpopsB &lt;- filter(stpops, Series == &quot;B&quot;)
stpopsB &lt;- select(stpopsB, -Series)</code></pre>
<p>CDC-supplied information on births by State for 1998–2002 were combined with calculated population projections for the same period, and birth rate per 1,000 total population was calculated. This time period was then combined with births and birth rate data for 2003–2015 into a single dataset. State abbreviations were added to the dataset by joining it with the built-in “state” dataset from R. A subset of this dataset was created by selecting data for only the 25 States whose data was used in the Pew study in order to explore potential differences in calculated birth rate over time due to selection bias.</p>
<pre class="r"><code>## Join state populations and calculate birth rate (also removes DC)
births9502 &lt;- inner_join(stpopsB, births9502) %&gt;%
        mutate(BirthRate = Births / Pop * 1000)</code></pre>
<pre><code>## Joining, by = c(&quot;Year&quot;, &quot;State&quot;)</code></pre>
<pre><code>## Warning: Column `State` joining character vector and factor, coercing into
## character vector</code></pre>
<pre class="r"><code>names(births9502) &lt;- c(&quot;Year&quot;, &quot;StateCode&quot;, &quot;TotalPopulation&quot;, &quot;State&quot;,
                       &quot;Births&quot;, &quot;BirthRate&quot;)

## Put all birth data into one data frame
births &lt;- rbind(births0306, births0715)
births &lt;- inner_join(births, st50)</code></pre>
<pre><code>## Joining, by = &quot;State&quot;</code></pre>
<pre><code>## Warning: Column `State` joining factor and character vector, coercing into
## character vector</code></pre>
<pre class="r"><code>births &lt;- births[complete.cases(births),]

births9502 &lt;- mutate(births9502, Year = as.integer(Year)) %&gt;%
        select(Year, State, Births, TotalPopulation, BirthRate, StateCode)
births &lt;- rbind(births9502, births)
births &lt;- arrange(births, Year, State)</code></pre>
<p>The average US birth rate by year was obtained by summing the births and total State populations over all States and calculating the birth rate per 1,000 total population. The average birth rate by year for the 25 States whose data was used in the Pew study was obtained by summing the births and total State populations over those States and calculating the birth rate per 1,000 total population. Note that this gives “Crude Birth Rate” and not “General Fertility Rate.”</p>
<pre class="r"><code>USbirths &lt;- summarise(group_by(births, Year), sum(Births), sum(TotalPopulation))
names(USbirths) &lt;- c(&quot;Year&quot;, &quot;Births&quot;, &quot;TotalPopulation&quot;)
USbirths &lt;- mutate(USbirths, BirthRate = Births / TotalPopulation * 1000)
save(USbirths, file = &quot;USbirths.RData&quot;)</code></pre>
</div>
<div id="Step3" class="section level1">
<h1>Step 3 – Visualizing the Data</h1>
<p>Birth rates for each State were first plotted as time series using the ggplot2 package for R and then a step-wise line showing the US average was overlaid on the base plot.</p>
<pre class="r"><code>ggplot(births, aes(Year, BirthRate, color = StateCode)) + geom_point() +
        geom_step(data = USbirths, aes(x=Year, y=BirthRate, color=&quot;US&quot;,
                                        size=1), show.legend = FALSE) +
        labs(title = &quot;Births per 1,000 People by State and US Average&quot;,
             x = &quot;Year&quot;,
             y = &quot;Births per 1,000 People&quot;,
             color = &quot;State&quot;)</code></pre>
<p><img src="/post/2017-05-05-visualizing-us-birth-rate-from-1998-to-2015_files/figure-html/plot-US-1.png" width="672" /></p>
<p>The overall US birth rate did decline sharply beginning in 2008 and has not appreciably increased since the decline began.<br />
Average birth rate for the 25 States whose data was used in the Pew study was plotted against the average US birth rate for the same time period. The plot shows that the Pew average is consistently lower than the US average, although the differences are minor. The diagonal line shows where the points would fall if the two rates were identical.</p>
<pre class="r"><code>## See if Pew states are different
pewstates &lt;- c(&quot;AL&quot;, &quot;AZ&quot;, &quot;CA&quot;, &quot;CO&quot;, &quot;FL&quot;, &quot;HI&quot;, &quot;IA&quot;, &quot;ID&quot;, &quot;KS&quot;, &quot;MD&quot;,
               &quot;MI&quot;, &quot;MN&quot;, &quot;MO&quot;, &quot;MS&quot;, &quot;NC&quot;, &quot;ND&quot;, &quot;NE&quot;, &quot;NH&quot;, &quot;PA&quot;, &quot;SD&quot;,
               &quot;TN&quot;, &quot;UT&quot;, &quot;VA&quot;, &quot;WA&quot;, &quot;WI&quot;)
pewbirths &lt;- filter(births, StateCode %in% pewstates)
pewsum &lt;- summarise(group_by(pewbirths, Year), sum(Births), sum(TotalPopulation))
names(pewsum) &lt;- c(&quot;Year&quot;, &quot;Births&quot;, &quot;TotalPopulation&quot;)
pewsum &lt;- mutate(pewsum, BirthRate2 = Births / TotalPopulation * 1000)

pewplot &lt;- tibble(Year = pewsum$Year, PewRate = pewsum$BirthRate2,
                  USRate = USbirths$BirthRate)

ggplot(data = pewplot, aes(x=USRate, y=PewRate)) + geom_point() +
        geom_abline(color = &quot;blue&quot;, slope = 1, intercept = 0,
                    show.legend = FALSE) +
        labs(title = &quot;Comparison of Calculated Birth Rates for 25 and 50 States&quot;,
             x = &quot;Average Births per 1,000 People, 50 States&quot;,
             y = &quot;Average Births per 1,000 People, 25 States\n
             (used in 2010 Pew report)&quot;)</code></pre>
<p><img src="/post/2017-05-05-visualizing-us-birth-rate-from-1998-to-2015_files/figure-html/plot-Pew-1.png" width="672" /></p>
</div>
<div id="Conclusion" class="section level1">
<h1>Conclusion</h1>
<p>For the decade leading up to 2008, the US birth rate had been gradually declining. Beginning in 2008 it experienced a steep decrease, perhaps due in part to the economic circumstances. Nevertheless, the birth rate has not appreciably increased in the years since the recession, despite an improving economy.</p>
<p>Although the average birth rate of the 25 States whose data was used in the Pew study is somewhat lower than that calculated using data from all 50 States, the differences are small enough that the sample appears representative of the whole.</p>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Gretchen Livingston and D’Vera Cohn, <em>U.S. Birth Rate Decline Linked to Recession</em>, <a href="http://www.pewsocialtrends.org/2010/04/06/us-birth-rate-decline-linked-to-recession/" class="uri">http://www.pewsocialtrends.org/2010/04/06/us-birth-rate-decline-linked-to-recession/</a>.<a href="#fnref1">↩</a></p></li>
</ol>
</div>

    </div>
  </article>

  


</main>

      <footer class="footer">
        <ul class="footer-links">
          <li>
            <a href="/index.xml" type="application/rss+xml" target="_blank">RSS feed</a>
          </li>
          <li>
            <a href="https://gohugo.io/" class="footer-links-kudos">Made with <img src="/images/hugo-logo.png" width="22" height="22"></a>
          </li>
        </ul>
      </footer>

    </div>
    



<script src="//cdn.bootcss.com/highlight.js/9.11.0/highlight.min.js"></script>



<script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/r.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/yaml.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



    
<script src="/js/math-code.js"></script>
<script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>


    
  </body>
</html>

